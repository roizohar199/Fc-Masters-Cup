<div dir="rtl" style="text-align: right;">

# ✅ רשימת משימות להעלאת מנגנון אישור משתמשים

**מנהל:** fcmasters9@gmail.com  
**זמן כולל:** 15-20 דקות

---

## 📋 לפני שמתחילים

### בדיקה מקומית (במחשב שלך):

```powershell
# 1. הרץ סקריפט בדיקה
.\בדוק-מנגנון-אישור.ps1
```

אם הכל תקין, תראה: `✅ הבדיקה הושלמה בהצלחה!`

---

## 🚀 שלבי ההעלאה

### ☑️ שלב 1: הכנה במחשב (5 דקות)

- [ ] פתח PowerShell בתיקיית הפרויקט
- [ ] הרץ: `npm run build` (בשרת ובלקוח)
- [ ] ערוך את `deploy-env-production.txt`:
  - שנה `SITE_URL` לדומיין שלך
  - שנה `CORS_ORIGIN` לדומיין שלך
- [ ] שמור כ-`.env`

### ☑️ שלב 2: גיבוי (2 דקות)

פתח **WinSCP** והתחבר לשרת:

- [ ] נווט ל-`/var/www/fcmasters`
- [ ] שכפל את `server` → `server-backup-2025-10-18`

### ☑️ שלב 3: העלאה (3 דקות)

ב-**WinSCP**, העלה:

- [ ] `server/dist/` → `/var/www/fcmasters/server/dist/`
- [ ] `.env` → `/var/www/fcmasters/.env`
- [ ] `client/dist/` → `/var/www/fcmasters/client/dist/` (אם שינית משהו)

### ☑️ שלב 4: אתחול (1 דקה)

פתח **PuTTY** והתחבר לשרת:

```bash
cd /var/www/fcmasters
pm2 restart fc-masters
pm2 logs fc-masters --lines 20
```

חפש: `✅ Added approvalStatus column to users table`

### ☑️ שלב 5: בדיקות (5 דקות)

#### בדיקה 1: האתר עובד
- [ ] גש לאתר בדפדפן
- [ ] וודא שהאתר נטען

#### בדיקה 2: התחברות מנהל
- [ ] התחבר עם: `fcmasters9@gmail.com`
- [ ] וודא שנכנס בלי בעיה

#### בדיקה 3: רישום משתמש חדש
- [ ] פתח חלון פרטי בדפדפן
- [ ] נסה להירשם עם משתמש דמה: `test@example.com`
- [ ] וודא שקיבלת הודעה: "ההרשמה התקבלה... ממתין לאישור"

#### בדיקה 4: אישור משתמש
- [ ] נסה להתחבר עם `test@example.com` - צריך להיות חסום
- [ ] בדוק שהמנהל קיבל מייל עם כפתורי אישור
- [ ] לחץ על "אשר משתמש"
- [ ] נסה להתחבר שוב - עכשיו זה צריך לעבוד

---

## 🎉 סיימת!

אם כל הבדיקות עברו - **מנגנון האישור פעיל!**

---

## 🆘 מה לעשות אם משהו לא עובד?

### המיילים לא נשלחים:

```bash
# בשרת (PuTTY):
pm2 logs fc-masters --lines 50
```

חפש שורות עם `[email]` ובדוק אם יש שגיאות.

### האתר לא עובד:

```bash
# שחזר מגיבוי:
cd /var/www/fcmasters
rm -rf server/dist
cp -r server-backup-2025-10-18/dist server/
pm2 restart fc-masters
```

### שגיאה בטבלה:

```bash
# תקן ידנית:
cd /var/www/fcmasters/server
node -e "
const db = require('better-sqlite3')('tournaments.sqlite');
db.exec('ALTER TABLE users ADD COLUMN approvalStatus TEXT NOT NULL DEFAULT \"approved\"');
db.exec('ALTER TABLE users ADD COLUMN approvalToken TEXT');
console.log('✅ Fixed!');
"
```

---

## 📞 צריך עזרה?

**קרא את המדריך המפורט:**
- `הוראות-העלאת-מנגנון-אישור-למנהל.md`

**הרץ בדיקה מקומית:**
```powershell
.\בדוק-מנגנון-אישור.ps1
```

---

**בהצלחה! 🚀**

</div>

