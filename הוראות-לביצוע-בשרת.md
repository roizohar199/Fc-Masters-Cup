# ğŸ–¥ï¸ ×”×•×¨××•×ª ×œ×‘×™×¦×•×¢ ×‘×©×¨×ª - k-rstudio.com

## ğŸ“‹ ×¡×™×›×•×
××—×¨×™ ×©×“×—×¤×ª ××ª ×›×œ ×”×©×™× ×•×™×™× ×œ-Git, ×ª×¦×˜×¨×š ×œ×‘×¦×¢ **×¤×¢×•×œ×•×ª ××œ×• ×‘×©×¨×ª** ×›×“×™ ×œ×ª×§×Ÿ ××ª ×‘×¢×™×™×ª WebSocket.

---

## ğŸš€ ×©×œ×‘ 1: ××©×•×š ××ª ×”×©×™× ×•×™×™× ×-Git

×”×ª×—×‘×¨ ×œ×©×¨×ª ×•××©×•×š ××ª ×”×¢×“×›×•× ×™×:

```bash
# ×”×ª×—×‘×¨ ×œ×©×¨×ª
ssh root@k-rstudio.com

# × ×•×•×˜ ×œ×ª×™×§×™×™×ª ×”×¤×¨×•×™×§×˜
cd /var/www/fcmasters

# ××©×•×š ××ª ×”×©×™× ×•×™×™× ×-Git
git pull origin master

# ×”×ª×§×Ÿ ×ª×œ×•×™×•×ª (×× ×™×© ×¢×“×›×•× ×™×)
cd server
npm install
cd ../client
npm install
cd ..
```

---

## ğŸ”’ ×©×œ×‘ 2: ×”×ª×§×Ÿ SSL Certificate (×× ×¢×“×™×™×Ÿ ×œ× ×§×™×™×)

×‘×“×•×§ ×× ×™×© ×œ×š SSL Certificate:

```bash
sudo ls -la /etc/letsencrypt/live/k-rstudio.com/
```

**×× ××™×Ÿ** (××• ×™×© ×©×’×™××”), ×”×ª×§×Ÿ Let's Encrypt:

```bash
# ×”×ª×§×Ÿ Certbot
sudo apt update
sudo apt install certbot python3-certbot-nginx -y

# ×™×¦×™×¨×ª SSL certificate
sudo certbot --nginx -d k-rstudio.com -d www.k-rstudio.com
```

Certbot ×™×©××œ ××•×ª×š ××¡×¤×¨ ×©××œ×•×ª:
1. **Email**: ×”×›× ×¡ email ×ª×§×£ ×œ×§×‘×œ×ª ×”×ª×¨××•×ª
2. **Terms of Service**: ×”×§×œ×“ `Y` (×”×¡×›××”)
3. **Share email**: `N` (×œ× ×—×•×‘×”)
4. **Redirect HTTP to HTTPS**: ×”×§×œ×“ `2` (Yes - ××•××œ×¥!)

---

## ğŸ”§ ×©×œ×‘ 3: ×¢×“×›×Ÿ ××ª ×ª×¦×•×¨×ª Nginx

### ××•×¤×¦×™×” ×': ×”×¢×ª×§×” ×™×“× ×™×ª (××•××œ×¦×ª)

```bash
# ×’×™×‘×•×™ ×”×ª×¦×•×¨×” ×”× ×•×›×—×™×ª
sudo cp /etc/nginx/sites-available/fcmasters /etc/nginx/sites-available/fcmasters.backup-$(date +%Y%m%d-%H%M%S)

# ×¢×¨×•×š ××ª ×”×ª×¦×•×¨×”
sudo nano /etc/nginx/sites-available/fcmasters
```

**×‘××¡×š ×”× ×× ×•:**
1. ××—×§ ××ª **×›×œ ×”×ª×•×›×Ÿ** ×”×™×©×Ÿ (Ctrl+K ×›××” ×¤×¢××™×)
2. ×”×¢×ª×§ ××ª ×”×ª×•×›×Ÿ ××”×§×•×‘×¥ `nginx-config-k-rstudio-ssl.txt` (×‘×¤×¨×•×™×§×˜ ×”××§×•××™)
3. ×”×“×‘×§ (Ctrl+Shift+V ××• ×œ×—×¦×Ÿ ×™×× ×™)
4. ×©××•×¨ (Ctrl+O, Enter, Ctrl+X)

### ××•×¤×¦×™×” ×‘': ×”×¢×ª×§×” ××”××—×©×‘ ×”××§×•××™

×× ×™×© ×œ×š ××ª ×”×§×•×‘×¥ ×‘××—×©×‘ ×”××§×•××™:

```bash
# ××”××—×©×‘ ×”××§×•××™ ×©×œ×š (Windows PowerShell):
scp "C:\FC Masters Cup\nginx-config-k-rstudio-ssl.txt" root@k-rstudio.com:/tmp/nginx-new-config.txt

# ×‘×©×¨×ª:
sudo cp /tmp/nginx-new-config.txt /etc/nginx/sites-available/fcmasters
```

### ×‘×“×™×§×” ×•×˜×¢×™× ×” ××—×“×©:

```bash
# ×‘×“×•×§ ××ª ×”×ª×¦×•×¨×”
sudo nginx -t

# ×× ×”×›×œ ×ª×§×™×Ÿ - ×˜×¢×Ÿ ××—×“×©
sudo systemctl reload nginx

# ×‘×“×•×§ ×¡×˜×˜×•×¡
sudo systemctl status nginx
```

---

## ğŸ“ ×©×œ×‘ 4: ×¢×“×›×Ÿ ××ª ×§×•×‘×¥ .env ×‘×©×¨×ª

×•×•×“× ×©×”×¢×¨×›×™× × ×›×•× ×™×:

```bash
# ×¢×¨×•×š ××ª .env ×‘×©×¨×ª
nano /var/www/fcmasters/server/.env
```

**×•×•×“× ×©×™×©:**
```env
# ×¢×¨×›×™× ××œ×• **×—×™×™×‘×™×** ×œ×”×™×•×ª × ×›×•× ×™×!
CORS_ORIGIN=https://www.k-rstudio.com
SITE_URL=https://www.k-rstudio.com
NODE_ENV=production
PORT=8787
```

×©××•×¨ (Ctrl+O, Enter, Ctrl+X)

---

## ğŸ”„ ×©×œ×‘ 5: ×‘× ×” ××—×“×© ×•-Restart

```bash
# ×‘× ×” ××ª ×”×§×•×“
cd /var/www/fcmasters

# ×‘× ×” Client
cd client
npm run build

# ×‘× ×” Server
cd ../server
npm run build

# Restart ×”×©×¨×ª
pm2 restart fc-masters

# ×‘×“×•×§ ×¡×˜×˜×•×¡
pm2 status
pm2 logs fc-masters --lines 20
```

---

## âœ… ×©×œ×‘ 6: ×‘×“×™×§×” ×©×”×›×œ ×¢×•×‘×“

### ×‘×“×™×§×” 1: ×‘×“×•×§ ×œ×•×’×™×

```bash
# ×œ×•×’×™ PM2
pm2 logs fc-masters --lines 50

# ×œ×•×’×™ Nginx
sudo tail -f /var/log/nginx/error.log
```

×—×¤×©:
- âœ… `Server started successfully on http://localhost:8787`
- âœ… `Presence WebSocket attached to /presence`
- âŒ **××™×Ÿ ×©×’×™××•×ª** ×©×œ SSL ××• WebSocket

### ×‘×“×™×§×” 2: ×‘×“×•×§ Ports

```bash
# ×•×•×“× ×©×”×©×¨×ª ×××–×™×Ÿ
sudo netstat -tlnp | grep 8787

# ×•×•×“× ×©-Nginx ×××–×™×Ÿ ×¢×œ 443
sudo netstat -tlnp | grep 443
```

### ×‘×“×™×§×” 3: ×‘×“×™×§×” ×‘×“×¤×“×¤×Ÿ

×¤×ª×—: `https://www.k-rstudio.com`

1. ×¤×ª×— **Console** (F12)
2. ×—×¤×© ××ª ×”×”×•×“×¢×•×ª:
   ```
   ğŸ”Œ Connecting to WebSocket: wss://www.k-rstudio.com/presence
   âœ… WebSocket connected successfully
   ğŸ‘‹ Presence hello: X users
   ```

×× ××ª×” ×¨×•××” ××ª ×–×” - **××–×œ ×˜×•×‘!** ×”×›×œ ×¢×•×‘×“! ğŸ‰

---

## âŒ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª

### ×‘×¢×™×”: SSL Certificate ×œ× × ××¦×

**×©×’×™××”:**
```
nginx: [emerg] cannot load certificate
```

**×¤×ª×¨×•×Ÿ:**
```bash
sudo certbot --nginx -d k-rstudio.com -d www.k-rstudio.com
sudo systemctl reload nginx
```

---

### ×‘×¢×™×”: WebSocket ×¢×“×™×™×Ÿ × ×›×©×œ (1006)

**×‘×“×™×§×”:**
```bash
# ×‘×“×•×§ ×©×”×©×¨×ª ×¨×¥
pm2 status

# ×‘×“×•×§ ×œ×•×’×™×
pm2 logs fc-masters --lines 50

# ×‘×“×•×§ Nginx
sudo tail -f /var/log/nginx/error.log
```

**×¤×ª×¨×•×Ÿ:**
```bash
# Restart ×”×›×œ
pm2 restart fc-masters
sudo systemctl reload nginx
```

---

### ×‘×¢×™×”: Port 443 ×ª×¤×•×¡

**×©×’×™××”:**
```
bind() to 0.0.0.0:443 failed (98: Address already in use)
```

**×¤×ª×¨×•×Ÿ:**
```bash
# ×‘×“×•×§ ××™ ×ª×•×¤×¡ ××ª Port 443
sudo lsof -i :443

# ×× ×™×© Apache ××• ×©×¨×ª ××—×¨, ×¢×¦×•×¨ ××•×ª×•
sudo systemctl stop apache2

# ×˜×¢×Ÿ ××—×“×© Nginx
sudo systemctl reload nginx
```

---

### ×‘×¢×™×”: CORS Error

**×©×’×™××” ×‘×“×¤×“×¤×Ÿ:**
```
Access to XMLHttpRequest blocked by CORS policy
```

**×¤×ª×¨×•×Ÿ:**
```bash
# ×•×“× ×©×‘-.env ×™×©:
nano /var/www/fcmasters/server/.env

# ×•×•×“×:
CORS_ORIGIN=https://www.k-rstudio.com

# Restart
pm2 restart fc-masters
```

---

## ğŸ“Š Check List - ×œ×‘×™×¦×•×¢ ×‘×©×¨×ª

- [ ] ××©×›×ª×™ ××ª ×”×©×™× ×•×™×™× ×-Git (`git pull`)
- [ ] SSL Certificate ××•×ª×§×Ÿ (Certbot)
- [ ] ×ª×¦×•×¨×ª Nginx ×¢×•×“×›× ×” ×¢× SSL + WebSocket
- [ ] `nginx -t` ×¢×•×‘×¨ ×œ×œ× ×©×’×™××•×ª
- [ ] Nginx × ×˜×¢×Ÿ ××—×“×© (`systemctl reload nginx`)
- [ ] `.env` ×¢×•×“×›×Ÿ ×¢× CORS_ORIGIN × ×›×•×Ÿ
- [ ] Client × ×‘× ×” ××—×“×© (`npm run build`)
- [ ] Server × ×‘× ×” ××—×“×© (`npm run build`)
- [ ] PM2 ×¢×©×” restart (`pm2 restart fc-masters`)
- [ ] ×”×“×¤×“×¤×Ÿ ××¦×™×’ "âœ… WebSocket connected successfully"
- [ ] ××™×Ÿ ×©×’×™××•×ª ×‘×œ×•×’×™×

---

## ğŸ‰ ×¡×™×›×•×

××—×¨×™ ×‘×™×¦×•×¢ ×›×œ ×”×©×œ×‘×™×:
1. âœ… ×”××ª×¨ ×¨×¥ ×¢×œ HTTPS ×××•×‘×˜×—
2. âœ… WebSocket ×¢×•×‘×“ ×“×¨×š WSS
3. âœ… ××¢×¨×›×ª ×”× ×•×›×—×•×ª ×¢×•×‘×“×ª ×‘×–××Ÿ ×××ª
4. âœ… ×›×œ ×”×ª×¢×‘×•×¨×” ××•×¢×‘×¨×ª ××•×˜×•××˜×™×ª ×œ-HTTPS

---

## ğŸ†˜ ×¢×“×™×™×Ÿ ×œ× ×¢×•×‘×“?

1. **××¡×•×£ ×œ×•×’×™×:**
   ```bash
   pm2 logs fc-masters --lines 100 > ~/server-logs.txt
   sudo tail -n 100 /var/log/nginx/error.log > ~/nginx-error.txt
   sudo nginx -T > ~/nginx-config.txt
   ```

2. **×”×•×¨×“ ××ª ×”×œ×•×’×™× ×œ××—×©×‘ ×”××§×•××™:**
   ```bash
   scp root@k-rstudio.com:~/server-logs.txt .
   scp root@k-rstudio.com:~/nginx-error.txt .
   scp root@k-rstudio.com:~/nginx-config.txt .
   ```

3. **×‘×“×•×§ ××ª ×”×œ×•×’×™×** ×•×ª×–×”×” ××ª ×”×‘×¢×™×”

---

**×‘×”×¦×œ×—×”!** ğŸš€

