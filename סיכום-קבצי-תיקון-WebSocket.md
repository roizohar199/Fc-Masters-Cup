# ğŸ“¦ ×¡×™×›×•× ×§×‘×¦×™ ×ª×™×§×•×Ÿ WebSocket

## ğŸ¯ ××˜×¨×”
×ª×™×§×•×Ÿ ×‘×¢×™×™×ª WebSocket connection ×¢×œ k-rstudio.com:
```
WebSocket connection to 'wss://www.k-rstudio.com/presence' failed
```

---

## ğŸ“‚ ×§×‘×¦×™× ×©× ×•×¦×¨×•

### 1ï¸âƒ£ ×ª×¦×•×¨×•×ª Nginx

#### `nginx-config-k-rstudio-ssl.txt`
**×ª×™××•×¨:** ×ª×¦×•×¨×ª Nginx ××œ××” ×¢× HTTPS + WebSocket  
**×©×™××•×©:** ×”×¢×œ×” ×œ×©×¨×ª ×‘Ö¾`/etc/nginx/sites-available/fcmasters`

**××” ×‘×ª×•×›×•:**
- âœ… HTTPS ×¢×œ port 443
- âœ… SSL Certificate (Let's Encrypt)
- âœ… WebSocket headers × ×›×•× ×™×
- âœ… Redirect ××•×˜×•××˜×™ ×Ö¾HTTP ×œÖ¾HTTPS
- âœ… Security headers

---

### 2ï¸âƒ£ ×¡×§×¨×™×¤×˜×™× ×œ×”×¢×œ××” ××•×˜×•××˜×™×ª

#### `update-nginx-ssl.ps1` (Windows PowerShell)
**×ª×™××•×¨:** ×¡×§×¨×™×¤×˜ ××•×˜×•××˜×™ ×œ×”×¢×œ××ª ×”×ª×¦×•×¨×” ×œ×©×¨×ª  
**×©×™××•×©:**
```powershell
.\update-nginx-ssl.ps1
```

**××” ×”×•× ×¢×•×©×”:**
1. ××¢×œ×” ××ª ×”×ª×¦×•×¨×” ×œ×©×¨×ª
2. ×™×•×¦×¨ ×’×™×‘×•×™ ×©×œ ×”×ª×¦×•×¨×” ×”× ×•×›×—×™×ª
3. ××—×œ×™×£ ××ª ×”×ª×¦×•×¨×”
4. ×‘×•×“×§ ×ª×§×™× ×•×ª (`nginx -t`)
5. ×˜×•×¢×Ÿ ××—×“×© ××ª Nginx

---

#### `update-nginx-ssl.sh` (Linux/macOS Bash)
**×ª×™××•×¨:** ××•×ª×• ×¡×§×¨×™×¤×˜, ××‘×œ ×œÖ¾Linux/macOS  
**×©×™××•×©:**
```bash
chmod +x update-nginx-ssl.sh
./update-nginx-ssl.sh
```

**××” ×”×•× ×¢×•×©×”:** ××•×ª×• ×“×‘×¨ ×›××• ×”×’×¨×¡×ª PowerShell

---

### 3ï¸âƒ£ ×¡×§×¨×™×¤×˜×™× ×œ×‘×“×™×§×”

#### `test-websocket-ssl.ps1` (Windows PowerShell)
**×ª×™××•×¨:** ×‘×“×™×§×” ××•×˜×•××˜×™×ª ×©×œ ×›×œ ×”×¨×›×™×‘×™×  
**×©×™××•×©:**
```powershell
.\test-websocket-ssl.ps1
```

**××” ×”×•× ×‘×•×“×§:**
1. âœ… ×—×™×‘×•×¨ HTTPS
2. âœ… SSL Certificate (×ª×•×§×£, ×ª×¤×•×’×”)
3. âœ… API Endpoint
4. âœ… WebSocket Endpoint
5. âœ… Server Backend (××•×¤×¦×™×•× ×œ×™)

---

#### `test-websocket-connection.html` (HTML + JavaScript)
**×ª×™××•×¨:** ×‘×“×™×§×” ×•×™×–×•××œ×™×ª ×‘×“×¤×“×¤×Ÿ  
**×©×™××•×©:** ×¤×ª×— ×‘×“×¤×“×¤×Ÿ, ×”×›× ×¡ URL, ×œ×—×¥ "×”×ª×—×‘×¨"

**××” ×”×•× ×¢×•×©×”:**
- ğŸ”Œ ××ª×—×‘×¨ ×œÖ¾WebSocket
- ğŸ“Š ××¦×™×’ ×œ×•×’×™× ×‘×–××Ÿ ×××ª
- ğŸ¨ ×××©×§ ×™×“×™×“×•×ª×™ ×‘×¢×‘×¨×™×ª
- ğŸ” ××¡×‘×™×¨ ×©×’×™××•×ª × ×¤×•×¦×•×ª

---

### 4ï¸âƒ£ ××“×¨×™×›×™×

#### `×ª×™×§×•×Ÿ-WebSocket-SSL.md`
**×ª×™××•×¨:** ××“×¨×™×š ××¤×•×¨×˜ ×¢× ×”×¡×‘×¨×™× ×˜×›× ×™×™×  
**××ª××™× ×œ:** ××™ ×©×¨×•×¦×” ×œ×”×‘×™×Ÿ ×‘×“×™×•×§ ××” ×§×•×¨×”

**×ª×•×›×Ÿ:**
- ğŸ“– ×”×¡×‘×¨ ×¢×œ ×”×‘×¢×™×”
- ğŸ› ï¸ ×”×•×¨××•×ª ×”×ª×§× ×” ××¤×•×¨×˜×•×ª
- âŒ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª × ×¤×•×¦×•×ª
- ğŸ’¡ ×˜×™×¤×™× ×•×˜×¨×™×§×™×

---

#### `README-×ª×™×§×•×Ÿ-WebSocket.md`
**×ª×™××•×¨:** README ××§×™×£ ×¢× ×›×œ ×”××™×“×¢  
**××ª××™× ×œ:** ××™ ×©×¨×•×¦×” ×ª××•× ×” ××œ××”

**×ª×•×›×Ÿ:**
- ğŸ“‹ ×ª×•×›×Ÿ ×¢× ×™×™× ×™× ××¡×•×“×¨
- ğŸš€ ×”×•×¨××•×ª ×©×™××•×© (××•×˜×•××˜×™ + ×™×“× ×™)
- ğŸ” ×‘×“×™×§×•×ª ××¤×•×¨×˜×•×ª
- âŒ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ××§×™×£
- âœ… Check List

---

#### `×ª×™×§×•×Ÿ-××”×™×¨-WebSocket.md`
**×ª×™××•×¨:** ×”×•×¨××•×ª ××”×™×¨×•×ª (3 ×“×§×•×ª)  
**××ª××™× ×œ:** ××™ ×©×¨×•×¦×” ×œ×ª×§×Ÿ ××”×¨ ×•×œ× ×œ×§×¨×•× ×”×¨×‘×”

**×ª×•×›×Ÿ:**
- âš¡ ×¤×ª×¨×•×Ÿ ×‘-3 ×©×œ×‘×™×
- ğŸ†˜ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª ×‘×§×¦×¨×”
- âœ… Check List ××™× ×™××œ×™

---

#### `×¡×™×›×•×-×§×‘×¦×™-×ª×™×§×•×Ÿ-WebSocket.md` (×”×§×•×‘×¥ ×”×–×”)
**×ª×™××•×¨:** ×¡×™×›×•× ×©×œ ×›×œ ×”×§×‘×¦×™×  
**××ª××™× ×œ:** ××™ ×©×¨×•×¦×” ×œ×“×¢×ª ××” ×›×œ ×§×•×‘×¥ ×¢×•×©×”

---

## ğŸš€ ××™×š ×œ×”×ª×—×™×œ?

### ×ª×¨×—×™×© 1: ×× ×™ ×¨×•×¦×” ×œ×ª×§×Ÿ ××”×¨
1. ×¤×ª×—: `×ª×™×§×•×Ÿ-××”×™×¨-WebSocket.md`
2. ×”×¤×¢×œ: `.\update-nginx-ssl.ps1`
3. ×‘×“×•×§: ×¤×ª×— ×”××ª×¨ ×‘Ö¾Console (F12)

---

### ×ª×¨×—×™×© 2: ×× ×™ ×¨×•×¦×” ×œ×”×‘×™×Ÿ ××” ×§×•×¨×”
1. ×§×¨×: `README-×ª×™×§×•×Ÿ-WebSocket.md`
2. ×§×¨×: `×ª×™×§×•×Ÿ-WebSocket-SSL.md`
3. ×”×¤×¢×œ: `.\update-nginx-ssl.ps1`
4. ×‘×“×•×§: `.\test-websocket-ssl.ps1`

---

### ×ª×¨×—×™×© 3: ×™×© ×œ×™ ×‘×¢×™×•×ª
1. ×”×¤×¢×œ: `.\update-nginx-ssl.ps1`
2. ×× × ×›×©×œ - ×§×¨× ××ª ×”×©×’×™××”
3. ×¤×ª×—: `×ª×™×§×•×Ÿ-WebSocket-SSL.md` â†’ ×—×œ×§ "×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª"
4. ×‘×“×•×§ ×œ×•×’×™×: `pm2 logs fc-masters`

---

## ğŸ“Š ×–×¨×™××ª ×¢×‘×•×“×” ××•××œ×¦×ª

```
×”×ª×—×œ×”
  â†“
×§×¨×: ×ª×™×§×•×Ÿ-××”×™×¨-WebSocket.md
  â†“
×”×¤×¢×œ: update-nginx-ssl.ps1
  â†“
×”×× ×”×¦×œ×™×—?
  â”œâ”€ ×›×Ÿ â†’ ×‘×“×•×§: test-websocket-ssl.ps1 â†’ ×¡×™×•× âœ…
  â””â”€ ×œ× â†’ ×§×¨×: ×ª×™×§×•×Ÿ-WebSocket-SSL.md (×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª)
           â†“
        ×ª×§×Ÿ ××ª ×”×‘×¢×™×”
           â†“
        ×”×¤×¢×œ ×©×•×‘: update-nginx-ssl.ps1
           â†“
        ×‘×“×•×§: test-websocket-ssl.ps1 â†’ ×¡×™×•× âœ…
```

---

## ğŸ¯ Check List ×›×œ×œ×™

### ×œ×¤× ×™ ×”×ª×™×§×•×Ÿ:
- [ ] ×™×© ×œ×™ ×’×™×©×ª SSH ×œ×©×¨×ª
- [ ] ×× ×™ ×™×•×“×¢ ××ª ×©× ×”××©×ª××© ×•×›×ª×•×‘×ª ×”×©×¨×ª
- [ ] ×”×©×¨×ª Node.js ×¨×¥ (`pm2 status`)

### ××—×¨×™ ×”×ª×™×§×•×Ÿ:
- [ ] SSL Certificate ××•×ª×§×Ÿ
- [ ] Nginx × ×˜×¢×Ÿ ××—×“×© ×‘×”×¦×œ×—×”
- [ ] CORS_ORIGIN × ×›×•×Ÿ ×‘Ö¾`.env`
- [ ] ×”×“×¤×“×¤×Ÿ ××¦×™×’ "âœ… WebSocket connected successfully"
- [ ] ××™×Ÿ ×©×’×™××•×ª ×‘Console

---

## ğŸ’¡ ×¢×¦×•×ª ×—×©×•×‘×•×ª

1. **×ª××™×“ ×¦×•×¨ ×’×™×‘×•×™** ×œ×¤× ×™ ×©×™× ×•×™×™× (×”×¡×§×¨×™×¤×˜ ×¢×•×©×” ×–××ª ××•×˜×•××˜×™×ª)
2. **×‘×“×•×§ ×œ×•×’×™×** ×× ××©×”×• ×œ× ×¢×•×‘×“:
   - Nginx: `sudo tail -f /var/log/nginx/error.log`
   - Server: `pm2 logs fc-masters`
3. **××œ ×ª×“×œ×’ ×¢×œ SSL Certificate** - ×–×” ×—×•×‘×” ×œÖ¾WebSocket Secure
4. **CORS_ORIGIN ×—×™×™×‘ ×œ×”×™×•×ª × ×›×•×Ÿ** - ××—×¨×ª ×”×—×™×‘×•×¨ ×™×›×©×œ

---

## ğŸ†˜ ××” ×œ×¢×©×•×ª ×× ×›×œ×•× ×œ× ×¢×•×‘×“?

1. **××¡×•×£ ×œ×•×’×™×:**
   ```bash
   sudo tail -n 50 /var/log/nginx/error.log > nginx-error.log
   pm2 logs fc-masters --lines 50 > server-logs.txt
   sudo nginx -T > nginx-full-config.txt
   ```

2. **×‘×“×•×§ ××ª ×”×ª×¦×•×¨×”:**
   ```bash
   sudo nginx -t
   pm2 status
   ```

3. **×©×—×–×¨ ×’×™×‘×•×™ ×× ×¦×¨×™×š:**
   ```bash
   sudo cp /etc/nginx/sites-available/fcmasters.backup-* /etc/nginx/sites-available/fcmasters
   sudo systemctl reload nginx
   ```

4. **×©×ª×£ ××ª ×”×œ×•×’×™×** ×›×“×™ ×œ×§×‘×œ ×¢×–×¨×”

---

## âœ¨ ×¡×™×›×•×

×™×© ×œ×š ×›×¢×ª **8 ×§×‘×¦×™×** ×©×™×¢×–×¨×• ×œ×š ×œ×ª×§×Ÿ ××ª ×‘×¢×™×™×ª WebSocket:

| ×¡×•×’ | ×§×‘×¦×™× | ××˜×¨×” |
|-----|-------|------|
| ×ª×¦×•×¨×” | 1 | `nginx-config-k-rstudio-ssl.txt` |
| ×¡×§×¨×™×¤×˜×™× ×œ×”×¢×œ××” | 2 | `update-nginx-ssl.ps1`, `update-nginx-ssl.sh` |
| ×¡×§×¨×™×¤×˜×™× ×œ×‘×“×™×§×” | 2 | `test-websocket-ssl.ps1`, `test-websocket-connection.html` |
| ××“×¨×™×›×™× | 3 | `×ª×™×§×•×Ÿ-WebSocket-SSL.md`, `README-×ª×™×§×•×Ÿ-WebSocket.md`, `×ª×™×§×•×Ÿ-××”×™×¨-WebSocket.md` |

**×”×ª×—×œ ×:** `×ª×™×§×•×Ÿ-××”×™×¨-WebSocket.md` ğŸš€

---

**×‘×”×¦×œ×—×”! ğŸ‰**

